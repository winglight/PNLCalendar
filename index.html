<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Calendar</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="toolbar">
        <div class="toolbar-left">
            <div class="date-picker-container">
                <button  onclick="toggleDatePicker()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                    </svg>
                    Date range
                </button>
                
                <div id="dateRangePicker" class="date-range-picker">
                    <div class="date-range">
                        <div class="date-picker-group">
                            <span>Start Date</span>
                            <input type="date" id="startDate">
                            <span>→</span>
                            <span>End Date</span>
                            <input type="date" id="endDate">
                        </div>
                        <div class="preset-dates">
                            <button onclick="setDateRange('today')">Today</button>
                            <button onclick="setDateRange('thisWeek')">This Week</button>
                            <button onclick="setDateRange('thisMonth')">This Month</button>
                            <button onclick="setDateRange('last30Days')">Last 30 Days</button>
                            <button onclick="setDateRange('lastMonth')">Last Month</button>
                            <button onclick="setDateRange('thisQuarter')">This Quarter</button>
                            <button onclick="setDateRange('ytd')">YTD (year to date)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="toolbar-right">
            <button  onclick="showImportModal()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                </svg>
                Import IB Data
            </button>
        </div>
    </div>    

<!-- 导入弹窗 -->
<div id="importModal" class="import-modal">
    <div class="import-modal-content">
        <h2>Import Trades</h2>
        <p>Auto import your trades from your broker or platform.</p>
        <form class="import-form" onsubmit="handleImport(event)">
            <div class="form-group">
                <label>Broker</label>
                <select class="broker-select">
                    <option value="ib">Interactive Brokers</option>
                </select>
            </div>
            <div class="form-group">
                <label>Flex Token <span style="color: red;">required</span></label>
                <input type="text" id="flexToken" required>
            </div>
            <div class="form-group">
                <label>Report Id <span style="color: red;">required</span></label>
                <input type="text" id="reportId" required>
            </div>
            <div class="form-group">
                <a target="_blank" href="https://intercom.help/tradezella-4066d388d93c/en/articles/6063403-interactive-broker-how-to-sync-your-interactive-broker-ibkr-account-with-tradezella">
                <label>How to get Token and Id</label>
                </a>
            </div>
            <button type="submit" class="connect-button">Connect</button>
        </form>
    </div>
</div>    
<div class="container">
    <div class="file-controls">
        <input type="file" id="csvFile" accept=".csv" class="file-input">
        <button onclick="clearData()">Clear Data</button>
    </div>
    <div class="header">
        <div class="month-nav">
            <button onclick="navigateMonth(-1)">←</button>
            <h2 id="currentMonth"></h2>
            <button onclick="navigateMonth(1)">→</button>
        </div>
        <div class="month-stats">
            <span>Monthly stats:</span>
            <span id="monthlyPnL"></span>
            <span id="tradingDays"></span>
        </div>
    </div>
    <div class="calendar" id="calendar"></div>
</div>
<!-- 添加交易详情弹窗 -->
<div id="tradeModal" class="trade-modal">
    <div class="trade-modal-content">
        <div class="modal-header">
            <h2 id="modalDate"></h2>
            <h2 id="modalNetPnL"></h2>
        </div>
        <div class="trade-stats">
            <div>
                <span>Total Trades: </span><span id="modalTotalTrades"></span>
                <span>Winners: </span><span id="modalWinners"></span>
                <span>Winrate: </span><span id="modalWinrate"></span>
            </div>
            <div>
                <span>Losers: </span><span id="modalLosers"></span>
                <span>Volume: </span><span id="modalVolume"></span>
                <span>Profit Factor: </span><span id="modalProfitFactor"></span>
            </div>
        </div>
        <table class="trades-table">
            <thead>
                <tr>
                    <th>Open Time</th>
                    <th>Ticker</th>
                    <th>Side</th>
                    <th>Instrument</th>
                    <th>Net P&L</th>
                    <th>Net ROI</th>
                    <th>Realized R-Multiple</th>
                    <th>Playbook</th>
                </tr>
            </thead>
            <tbody id="tradesTableBody">
            </tbody>
        </table>
        <div class="button-group">
            <button class="cancel-button" onclick="closeTradeModal()">Cancel</button>
            <button class="details-button" onclick="viewTradeDetails()">View Details</button>
        </div>
    </div>
</div>
<div class="stats-container">
    <!-- 统计指标卡片行 -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-header">
                <span>Net P&L</span>
                <span class="trade-count">95</span>
            </div>
            <div class="stat-value positive">$16,574.07</div>
        </div>
        
        <div class="stat-card" id="win-rate">
            <div class="stat-header">
                <span>Trade Win %</span>
                <span class="info-icon">ⓘ</span>
            </div>
            <div class="stat-value">77.89%</div>
            <div class="stat-gauge">
                <div class="win">74</div>
                <div class="neutral">0</div>
                <div class="loss">21</div>
            </div>
        </div>
        
        <div class="stat-card" id="profit-factor">
            <div class="stat-header">
                <span>Profit Factor</span>
                <span class="info-icon">ⓘ</span>
            </div>
            <div class="stat-value">1.47</div>
            <div class="profit-ring"></div>
        </div>
        
        <div class="stat-card" id="day-win-rate">
            <div class="stat-header">
                <span>Day Win %</span>
                <span class="info-icon">ⓘ</span>
            </div>
            <div class="stat-value">67.27%</div>
            <div class="stat-gauge">
                <div class="win">37</div>
                <div class="neutral">12</div>
                <div class="loss">18</div>
            </div>
        </div>
        <div class="stat-card" id="avg-win-loss">
            <div class="stat-header">
                <span>Avg win/loss trade</span>
                <span class="info-icon">ⓘ</span>
            </div>
            <div class="stat-value">67.27%</div>
            <div class="stat-gauge">
                <div class="win">37</div>
                <div class="loss">18</div>
            </div>
        </div>
    </div>

    <!-- 图表行 -->
    <div class="charts-section">
        <div class="chart-container">
            <h3>Daily Net Cumulative P&L</h3>
            <div class="chart-wrapper">
                <canvas id="cumulativePnLChart"></canvas>
            </div>
        </div>
        <div class="chart-container">
            <h3>Net Daily P&L</h3>
            <div class="chart-wrapper">
                <canvas id="dailyPnLChart"></canvas>
            </div>
        </div>
    </div>
    <div class="charts-container">
        <div class="chart-item">
            <h3>Trade Duration Performance</h3>
            <canvas id="durationPerformanceChart"></canvas>
        </div>
        <div class="chart-item">
            <h3>Trade Time Performance</h3>
            <canvas id="timePerformanceChart"></canvas>
        </div>
        <div class="chart-item">
            <h3>Drawdown</h3>
            <canvas id="drawdownChart"></canvas>
        </div>
    </div>
</div>

    <!-- Scripts -->
    <script src="r2-sync.js" type="module"></script>
    <script src="main.js" type="module"></script>
</body>
</html>